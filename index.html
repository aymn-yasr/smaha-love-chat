<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ar" dir="rtl">
<head>
<title>شات صدى الكلام , دردشة صدى الكلام</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="description" content="أهلاً وسهلاً بكم في شات صدى الكلام , دردشة صدى الكلام قابل الآن المزيد من الأشخاص عبر خدمه الدردشه الكتابيه شاهد أحبابك وأصدقائك نتمنى لكم أجمل الأوقات معنا تسجيل عضوية دخول بعضوية دخول الزوار عزيزي الزائر يمكنك الدخول كزائر بدون تسجيل شات صدى الكلام , دردشة صدى الكلام , شات عربي , دردشة عربية مجانية , شات العرب , دردشة عربية">
<meta name="keywords" content="شات صدى الكلام , دردشة صدى الكلام , موقع صدى الكلام , جات صدى الكلام , دخول شات صدى الكلام , دخول دردشة صدى الكلام , الغرفة العامة في شات صدى الكلام , روم شات صدى الكلام , تسجيل حساب في شات صدى الكلام , دخول الزوار في شات صدى الكلام">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<link id="siteicon" rel="shortcut icon" type="image/png" href="default_images/icon8a25.png?v=1.13"/>
<link rel="stylesheet" type="text/css" href="js/fancy/jquery.fancybox8a25.css?v=1.13" media="screen" />
<link rel="stylesheet" type="text/css" href="css/awesome/css/fontawesome.min8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="css/awesome/css/regular.min8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="css/awesome/css/solid.min8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="css/selectboxit8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="js/jqueryui/jquery-ui.min8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="css/main8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="control/login/Default20/login8a25.css?v=1.13" />
<link id="gradient_sheet" rel="stylesheet" type="text/css" href="css/colors8a25.css?v=1.13" />
<link id="actual_theme" rel="stylesheet" type="text/css" href="css/themes/Lite/Lite8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="css/responsive8a25.css?v=1.13" />
<script data-cfasync="false" src="js/jquery-3.5.1.min8a25.js?v=1.13"></script>
<script data-cfasync="false" src="system/language/Arabic/language8a25.js?v=1.13"></script>
<script data-cfasync="false" src="js/fancy/jquery.fancybox8a25.js?v=1.13"></script>
<script data-cfasync="false" src="js/jqueryui/jquery-ui.min8a25.js?v=1.13"></script>
<script data-cfasync="false" src="js/jqueryui/jquery_ui_punch8a25.js?v=1.13"></script>
<script data-cfasync="false" src="js/global.min8a25.js?v=1.13"></script>
<script data-cfasync="false" src="js/function_split8a25.js?v=1.13"></script>
<script data-cfasync="false" src="js/yall/yall8a25.js?v=1.13"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
	yall({
		observeChanges: true
	});
});
</script>
<link rel="stylesheet" type="text/css" href="css/rtl8a25.css?v=1.13" />
<link rel="stylesheet" type="text/css" href="css/custom8a25.css?v=1.13" />
<script data-cfasync="false">
	var pageEmbed = 0;
	var pageRoom = 1;
	var curPage = 'home';
	var loadPage = '';
	var bbfv = '?v=1.13';
	var rtlMode = '1';
</script>
<script data-cfasync="false">
	var logged = 0;
	var utk = '0';
</script>

<style>
    /* التعديلات اللونية والتنسيقية */
    body {
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); /* تدرج لوني للخلفية */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh; /* تأكد من أن الواجهة تملأ ارتفاع الشاشة */
        margin: 0;
        font-family: 'Cairo', sans-serif; /* تطبيق خط كايرو على الجسم بالكامل */
    }

    #login_wrap {
        background: rgba(255, 255, 255, 0.95); /* خلفية بيضاء شفافة لمربع الدخول */
        border-radius: 15px; /* حواف دائرية أكثر */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); /* ظل معزز */
        padding: 40px 30px; /* حشو داخلي */
        max-width: 450px; /* عرض أقصى للحفاظ على التناسق */
        width: 90%; /* عرض يتكيف مع الشاشات الصغيرة */
        text-align: center;
        position: relative; /* لضمان أن الظل يعمل بشكل صحيح */
        overflow: hidden; /* لإخفاء أي جزء زائد من الظل أو المحتوى */
    }

    .welecome {
        font-family: 'Cairo', sans-serif;
        font-size: 2.2em; /* حجم أكبر لرسالة الترحيب */
        font-weight: 700; /* جعل الخط أثقل */
        color: #333; /* لون نص داكن */
        margin-bottom: 25px; /* مسافة أسفل رسالة الترحيب */
        position: relative;
        padding-bottom: 15px;
    }

    .welecome::after {
        content: '';
        display: block;
        width: 60px;
        height: 4px;
        background-color: #2575fc; /* خط زخرفي تحت الترحيب */
        margin: 10px auto 0;
        border-radius: 2px;
    }

    .loginanag, .loginanar, .loginana {
        font-family: 'Cairo', sans-serif;
        font-size: 1.1em; /* حجم خط أكبر للأزرار */
        font-weight: 700;
        padding: 15px 25px; /* حشو أكبر للأزرار */
        border: none;
        border-radius: 30px; /* أزرار دائرية أكثر */
        margin-bottom: 15px; /* مسافة بين الأزرار */
        cursor: pointer;
        transition: all 0.3s ease; /* انتقال سلس عند التفاعل */
        display: block; /* جعل الأزرار تتكدس عمودياً */
        width: 100%; /* عرض كامل للزر */
        box-sizing: border-box; /* لضمان أن الحشو لا يزيد العرض الكلي */
    }

    .loginanag {
        background-color: #28a745; /* لون أخضر لزر الزوار */
        color: white;
    }

    .loginanag:hover {
        background-color: #218838; /* لون أغمق عند التمرير */
        transform: translateY(-3px); /* تأثير رفع بسيط */
    }

    .loginanar {
        background-color: #ffc107; /* لون أصفر لزر التسجيل */
        color: #333; /* نص داكن */
    }

    .loginanar:hover {
        background-color: #e0a800; /* لون أغمق عند التمرير */
        transform: translateY(-3px);
    }

    .loginana {
        background-color: #007bff; /* لون أزرق لزر الدخول بالعضوية */
        color: white;
    }

    .loginana:hover {
        background-color: #0056b3; /* لون أغمق عند التمرير */
        transform: translateY(-3px);
    }

    .loginanag i, .loginanar i, .loginana i {
        margin-left: 10px; /* مسافة بين الأيقونة والنص */
    }

    .warning-msg {
        background-color: #fff3cd; /* خلفية صفراء فاتحة للتنبيه */
        border-right: 5px solid #ffc107; /* شريط أصفر على اليمين */
        padding: 15px;
        margin-top: 25px;
        border-radius: 8px;
        color: #856404; /* نص أصفر داكن */
        font-size: 0.95em;
        line-height: 1.6;
        text-align: right;
    }

    .warning-msg p {
        margin: 0;
        font-family: 'Cairo', sans-serif;
        font-weight: bold;
    }

    .test_call span {
        background-color: #6c757d; /* لون رمادي لزر اتصل بنا */
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        display: inline-flex; /* لجعل الأيقونة والنص في سطر واحد */
        align-items: center;
        margin-top: 20px;
    }

    .test_call span:hover {
        background-color: #5a6268;
    }

    .test_call span p {
        margin: 0;
        font-family: 'Cairo', sans-serif;
        font-weight: bold;
    }

    .test_call span i {
        margin-left: 10px; /* مسافة بين الأيقونة والنص */
    }

    .agree2022 p {
        margin-top: 20px;
        font-size: 0.9em;
        color: #555;
    }

    .agree2022 span {
        color: #007bff; /* لون أزرق لرابط شروط الاستخدام */
        cursor: pointer;
        font-weight: bold;
        transition: color 0.3s ease;
    }

    .agree2022 span:hover {
        color: #0056b3;
        text-decoration: underline;
    }

    /* تعديلات بسيطة للموبايل */
    @media (max-width: 600px) {
        #login_wrap {
            padding: 30px 20px;
            margin: 15px; /* هوامش حول المربع على الجوال */
        }
        .welecome {
            font-size: 1.8em;
        }
        .loginanag, .loginanar, .loginana {
            font-size: 1em;
            padding: 12px 20px;
        }
    }

    /* --- CSS للمربع المنبثق المخصص (Register Modal & Guest Login Modal) --- */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7); /* خلفية سوداء شفافة */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000; /* ليكون فوق كل شيء */
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .modal-content-custom {
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        width: 90%;
        max-width: 400px;
        position: relative;
        text-align: right; /* محاذاة العناصر لليمين */
    }

    .modal-close-btn {
        position: absolute;
        top: 15px;
        right: 15px; /* تغيير من اليسار إلى اليمين للعربية */
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
        color: #777;
        padding: 0;
        line-height: 1;
        transition: color 0.2s ease;
    }

    .modal-close-btn:hover {
        color: #333;
    }

    .modal-title {
        font-size: 1.8em;
        font-weight: 700;
        color: #333;
        margin-bottom: 25px;
        text-align: center;
    }

    .modal-input-group {
        margin-bottom: 15px;
    }

    .modal-input {
        width: calc(100% - 20px); /* عرض كامل مع الأخذ في الاعتبار الحشو */
        padding: 12px 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
        box-sizing: border-box; /* لضمان أن الحشو لا يزيد العرض الكلي */
        font-family: 'Cairo', sans-serif;
        text-align: right; /* محاذاة النص لليمين */
    }

    .modal-input::placeholder {
        color: #aaa;
    }

    .modal-input:focus {
        border-color: #007bff;
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
    }

    .modal-select-group {
        display: flex;
        gap: 15px; /* مسافة بين قائمتي الاختيار */
        margin-bottom: 20px;
    }

    .modal-select-wrapper {
        flex: 1; /* لتوزيع المساحة بالتساوي */
        position: relative;
    }

    .modal-select {
        width: 100%;
        padding: 12px 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1em;
        background-color: white;
        appearance: none; /* لإخفاء سهم المتصفح الافتراضي */
        -webkit-appearance: none;
        -moz-appearance: none;
        cursor: pointer;
        font-family: 'Cairo', sans-serif;
        text-align: right; /* محاذاة النص لليمين */
        padding-left: 30px; /* لترك مساحة للأيقونة المخصصة */
    }

    .modal-select-wrapper::after {
        content: '▼'; /* أيقونة سهم مخصصة */
        position: absolute;
        top: 50%;
        left: 10px; /* وضع الأيقونة على اليسار */
        transform: translateY(-50%);
        color: #777;
        pointer-events: none; /* لتجاهل النقر على الأيقونة */
    }

    .modal-submit-button {
        background-color: #007bff; /* لون الزر الرئيسي */
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 8px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        transition: background-color 0.3s ease, transform 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-submit-button:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
    }

    .modal-submit-button svg {
        fill: white;
        margin-left: 10px; /* مسافة بين الأيقونة والنص */
        width: 20px;
        height: 20px;
    }

    .modal-terms {
        font-size: 0.9em;
        color: #666;
        margin-top: 20px;
        text-align: center;
    }

    .modal-terms span {
        color: #007bff;
        cursor: pointer;
        font-weight: bold;
        transition: color 0.3s ease;
    }

    .modal-terms span:hover {
        color: #0056b3;
        text-decoration: underline;
    }

    /* --- CSS لرسائل الخطأ في أعلى الشاشة --- */
    .error-message-container {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 90%; /* عرض يتكيف مع الشاشات */
        max-width: 450px; /* عرض أقصى */
        background-color: #dc3545; /* لون أحمر */
        color: white;
        text-align: center;
        padding: 15px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        z-index: 1001; /* ليكون فوق المودالات */
        display: none; /* مخفية افتراضيًا */
        border-bottom-left-radius: 8px;
        border-bottom-right-radius: 8px;
        font-family: 'Cairo', sans-serif;
        font-weight: bold;
        opacity: 0; /* للتحريك السلس */
        transition: opacity 0.3s ease-in-out; /* انتقال سلس للظهور والاختفاء */
    }

    .error-message-container.show {
        opacity: 1; /* إظهار الرسالة */
    }
</style>

<script type="module">
  // استيراد الدوال التي تحتاجها من Firebase SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
  // تم تحديث هذا السطر ليتضمن 'get', 'query', 'orderByChild', 'equalTo'
  import { getDatabase, ref, set, update, push, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js"; 

  // إعدادات تطبيق الويب الخاص بك في Firebase (تم توفيرها من قبلك)
  const firebaseConfig = {
    apiKey: "AIzaSyAbISM6qh9DHAyBTqWWhkVU-Nb09U4CAR4",
    authDomain: "chat-sada-love.firebaseapp.com",
    projectId: "chat-sada-love",
    storageBucket: "chat-sada-love.firebasestorage.app",
    messagingSenderId: "979333283298",
    appId: "1:979333283298:web:fcc5bea24b193c69e98dbb"
  };

  // تهيئة Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // عناصر رسالة الخطأ (تأكد من وجودها في DOM)
  let errorMessageContainer;
  let errorMessageText;

  // اسم صفحة الشات الأساسية التي تريد الانتقال إليها
  const CHAT_PAGE_URL = "chat.html"; // تأكد من أن هذا هو المسار الصحيح لصفحة الشات

  // دالة لتحويل المستخدم إلى صفحة الشات
  function redirectToChatPage() {
    window.location.href = CHAT_PAGE_URL;
  }

  // دالة لتسجيل مستخدم جديد في Firebase Auth وتخزين بيانات إضافية في Realtime Database
  async function registerUser(email, password, username, age, gender) {
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      console.log("تم تسجيل المستخدم بنجاح:", user);

      // هنا نقوم بحفظ اسم المستخدم مع البريد الإلكتروني لتسهيل البحث به لاحقًا
      await set(ref(db, 'users/' + user.uid), {
        username: username, // حفظ اسم المستخدم الذي قد يكون مختلفًا عن البريد
        email: email,
        age: age,
        gender: gender,
        registeredAt: new Date().toISOString(),
        lastLogin: new Date().toISOString(),
        role: 'member' // دور افتراضي للعضو المسجل
      });
      console.log("تم حفظ بيانات العضو في Realtime Database");

      redirectToChatPage();
    } catch (error) {
      const errorCode = error.code;
      const errorMessage = error.message;
      console.error("خطأ في التسجيل:", errorCode, errorMessage);

      if (errorCode === 'auth/email-already-in-use') {
        displayTopMessage("هذا المستخدم مسجل بالفعل.", 'error');
      } else {
        displayTopMessage("حدث خطأ أثناء التسجيل: " + errorMessage, 'error');
      }
    }
  }

  // دالة لتسجيل دخول مستخدم موجود (تدعم البريد الإلكتروني أو اسم المستخدم)
  async function loginUser(identifier, password) {
    try {
        let emailToSignIn = identifier;

        // تعبير عادي للتحقق من صيغة البريد الإلكتروني
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        
        // إذا لم يكن المدخل بريد إلكتروني، افترض أنه اسم مستخدم
        if (!emailRegex.test(identifier)) {
            // ابحث عن المستخدم في Realtime Database باستخدام اسم المستخدم
            // يجب أن يكون لديك فهرس (index) لـ 'username' في قواعد Firebase Realtime Database
            const userQuery = query(ref(db, 'users'), orderByChild('username'), equalTo(identifier));
            const snapshot = await get(userQuery);

            if (snapshot.exists()) {
                // إذا تم العثور على المستخدم باسم المستخدم، استخدم البريد الإلكتروني المرتبط به
                const userData = Object.values(snapshot.val())[0]; // احصل على أول مستخدم مطابق
                emailToSignIn = userData.email;
            } else {
                // إذا لم يتم العثور على اسم المستخدم، ففشل تسجيل الدخول
                displayTopMessage("اسم المستخدم أو البريد الإلكتروني غير موجود.", 'error');
                return; 
            }
        }
        
        // استخدام البريد الإلكتروني (سواء كان المدخل الأصلي أو الذي تم العثور عليه من اسم المستخدم)
        const userCredential = await signInWithEmailAndPassword(auth, emailToSignIn, password);
        const user = userCredential.user;
        console.log("تم تسجيل الدخول بنجاح:", user);

        // تحديث وقت تسجيل الدخول في Realtime Database
        await update(ref(db, 'users/' + user.uid), {
            lastLogin: new Date().toISOString()
        });
        console.log("تم تحديث وقت تسجيل الدخول في Realtime Database");

        redirectToChatPage();

    } catch (error) {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.error("خطأ في تسجيل الدخول:", errorCode, errorMessage);
        
        let displayMsg = "خطأ في تسجيل الدخول. ";
        if (errorCode === 'auth/invalid-credential' || errorCode === 'auth/wrong-password' || errorCode === 'auth/user-not-found') {
            displayMsg += "البريد الإلكتروني/اسم المستخدم أو كلمة المرور غير صحيحة.";
        } else if (errorCode === 'auth/too-many-requests') {
            displayMsg += "تم حظر حسابك مؤقتًا بسبب محاولات دخول كثيرة فاشلة. حاول لاحقًا.";
        } else {
            displayMsg += errorMessage;
        }
        displayTopMessage(displayMsg, 'error');
    }
  }

  // دالة لدخول الزوار (بدون Firebase Auth)
  async function guestLogin(username, age, gender) {
    try {
      // توليد معرف فريد للزائر
      const newGuestRef = push(ref(db, 'guests')); // يستخدم push لتوليد معرف فريد
      const guestId = newGuestRef.key; // الحصول على المفتاح الذي تم توليده

      await set(newGuestRef, {
        username: username,
        age: age,
        gender: gender,
        joinedAt: new Date().toISOString(),
        isGuest: true, // علامة للتمييز كزائر
        guestId: guestId // حفظ المعرف داخل بيانات الزائر
      });
      console.log("تم تسجيل دخول الزائر بنجاح وحفظ بياناته في Realtime Database:", guestId);

      // هنا يمكنك تخزين معرف الزائر وبياناته في sessionStorage أو localStorage
      // لكي يتمكن تطبيق الشات من التعرف عليه كزائر
      sessionStorage.setItem('chatUserType', 'guest');
      sessionStorage.setItem('chatUserId', guestId);
      sessionStorage.setItem('chatUsername', username);
      sessionStorage.setItem('chatUserAge', age);
      sessionStorage.setItem('chatUserGender', gender);

      redirectToChatPage();
    } catch (error) {
      console.error("خطأ في دخول الزائر:", error);
      displayTopMessage("حدث خطأ أثناء دخول الزائر: " + error.message, 'error');
    }
  }

  // دالة لعرض رسالة في أعلى الشاشة (خطأ أو نجاح)
  function displayTopMessage(message, type = 'info') {
    if (!errorMessageContainer) {
        errorMessageContainer = document.getElementById('errorMessageContainer');
        errorMessageText = document.getElementById('errorMessageText');
    }

    if (errorMessageContainer && errorMessageText) {
      errorMessageText.textContent = message;
      errorMessageContainer.classList.remove('success', 'error', 'info'); // إزالة الفئات القديمة
      
      // تعيين لون الخلفية بناءً على نوع الرسالة
      if (type === 'error') {
          errorMessageContainer.style.backgroundColor = '#dc3545'; // أحمر
      } else if (type === 'success') {
          errorMessageContainer.style.backgroundColor = '#28a745'; // أخضر
      } else { // info أو أي نوع آخر
          errorMessageContainer.style.backgroundColor = '#007bff'; // أزرق
      }

      errorMessageContainer.classList.add('show');
      errorMessageContainer.style.display = 'block';

      setTimeout(() => {
        errorMessageContainer.classList.remove('show');
        setTimeout(() => {
            errorMessageContainer.style.display = 'none';
            errorMessageText.textContent = '';
        }, 300); // وقت انتظار بعد إزالة فئة 'show' قبل إخفاء العنصر تمامًا
      }, 5000); // تظهر الرسالة لمدة 5 ثوانٍ
    }
  }

  // --- دوال التحكم بالمربع المنبثق للتسجيل (Register Modal) ---
  const registerModalOverlay = document.getElementById('registerModalOverlay');
  const modalCloseBtn = document.getElementById('modalCloseBtn');
  const registerModalForm = document.getElementById('registerModalForm');
  const usernameInput = document.getElementById('usernameInput'); // لاسم المستخدم/البريد الإلكتروني للعضو المسجل
  const passwordInput = document.getElementById('passwordInput');
  const ageSelect = document.getElementById('ageSelect');
  const genderSelect = document.getElementById('genderSelect');

  // دوال التحكم بمربع الدخول المنبثق (Login Modal)
  const loginModalOverlay = document.getElementById('loginModalOverlay');
  const loginModalCloseBtn = document.getElementById('loginModalCloseBtn');
  const loginModalForm = document.getElementById('loginModalForm');
  // تم تغيير اسم المتغير هنا ليتوافق مع ID الجديد في HTML
  const loginIdentifierInput = document.getElementById('loginIdentifierInput'); 
  const loginPasswordInput = document.getElementById('loginPasswordInput');

  // دوال التحكم بمربع دخول الزوار المنبثق الجديد
  const guestLoginModalOverlay = document.getElementById('guestLoginModalOverlay');
  const guestLoginModalCloseBtn = document.getElementById('guestLoginModalCloseBtn');
  const guestLoginForm = document.getElementById('guestLoginForm');
  const guestUsernameInput = document.getElementById('guestUsernameInput');
  const guestAgeSelect = document.getElementById('guestAgeSelect');
  const guestGenderSelect = document.getElementById('guestGenderSelect');


  // دالة لإظهار المربع المنبثق للتسجيل
  function showRegisterModal() {
      registerModalOverlay.classList.add('active');
  }

  // دالة لإخفاء المربع المنبثق للتسجيل
  function hideRegisterModal() {
      registerModalOverlay.classList.remove('active');
      usernameInput.value = '';
      passwordInput.value = '';
      ageSelect.value = '';
      genderSelect.value = '';
  }

  // دوال المودال الجديد لتسجيل الدخول بالعضوية
  function showLoginModal() {
      loginModalOverlay.classList.add('active');
  }

  function hideLoginModal() {
      loginModalOverlay.classList.remove('active');
      loginIdentifierInput.value = ''; // تم تحديث اسم المتغير
      loginPasswordInput.value = '';
  }

  // دوال المودال الجديد لدخول الزوار
  function showGuestLoginModal() {
      guestLoginModalOverlay.classList.add('active');
  }

  function hideGuestLoginModal() {
      guestLoginModalOverlay.classList.remove('active');
      guestUsernameInput.value = '';
      guestAgeSelect.value = '';
      guestGenderSelect.value = '';
  }

  // معالج حدث لإغلاق المربع عند النقر على زر X للتسجيل
  if (modalCloseBtn) {
      modalCloseBtn.addEventListener('click', hideRegisterModal);
  }

  // معالج حدث لإغلاق المربع عند النقر خارج المحتوى للتسجيل
  if (registerModalOverlay) {
      registerModalOverlay.addEventListener('click', (e) => {
          if (e.target === registerModalOverlay) {
              hideRegisterModal();
          }
      });
  }

  // معالج حدث لتقديم نموذج التسجيل داخل المربع المنبثق (للعضوية الكاملة)
  if (registerModalForm) {
      registerModalForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          const email = usernameInput.value.trim();
          const password = passwordInput.value;
          // عند التسجيل، يمكن استخدام البريد الإلكتروني كاسم مستخدم مبدئي أو طلب اسم مستخدم منفصل
          // هنا نفترض أن usernameInput هو للبريد الإلكتروني، وسنطلب اسم مستخدم فريد لاحقًا إذا لزم الأمر
          const username = email.split('@')[0]; // استخدام الجزء الأول من البريد كاسم مستخدم مبدئي
          const age = ageSelect.value;
          const gender = genderSelect.value;

          if (email && password && age && gender) {
              hideRegisterModal();
              await registerUser(email, password, username, age, gender);
          } else {
              displayTopMessage("الرجاء تعبئة جميع الحقول المطلوبة للتسجيل.", 'error');
          }
      });
  }

  // --- معالجات أحداث لمربع الدخول المنبثق (للعضوية الكاملة) ---
  if (loginModalCloseBtn) {
      loginModalCloseBtn.addEventListener('click', hideLoginModal);
  }

  if (loginModalOverlay) {
      loginModalOverlay.addEventListener('click', (e) => {
          if (e.target === loginModalOverlay) {
              hideLoginModal();
          }
      });
  }

  if (loginModalForm) {
      loginModalForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          // جلب القيمة من الحقل الجديد الذي يقبل البريد الإلكتروني أو اسم المستخدم
          const identifier = loginIdentifierInput.value.trim(); 
          const password = loginPasswordInput.value;

          if (identifier && password) {
              hideLoginModal(); // أخفِ المودال أولاً قبل محاولة الدخول
              await loginUser(identifier, password);
          } else {
              displayTopMessage("الرجاء إدخال البريد الإلكتروني أو اسم المستخدم وكلمة المرور لتسجيل الدخول.", 'error');
          }
      });
  }

  // --- معالجات أحداث لمربع دخول الزوار المنبثق الجديد ---
  if (guestLoginModalCloseBtn) {
      guestLoginModalCloseBtn.addEventListener('click', hideGuestLoginModal);
  }

  if (guestLoginModalOverlay) {
      guestLoginModalOverlay.addEventListener('click', (e) => {
          if (e.target === guestLoginModalOverlay) {
              hideGuestLoginModal();
          }
      });
  }

  if (guestLoginForm) {
      guestLoginForm.addEventListener('submit', async (e) => {
          e.preventDefault();

          const username = guestUsernameInput.value.trim();
          const age = guestAgeSelect.value;
          const gender = guestGenderSelect.value;

          if (username && age && gender) {
              hideGuestLoginModal();
              await guestLogin(username, age, gender);
          } else {
              displayTopMessage("الرجاء تعبئة جميع الحقول المطلوبة لدخول الزوار.", 'error');
          }
      });
  }


  // --- ربط الدوال بأزرار صفحة الدخول ---
  function showRules() {
      alert("شروط الاستخدام:\n1. كن محترمًا.\n2. لا تنشر محتوى غير لائق.\n3. التزم بجميع القواعد الأخرى.\nشكراً لتفهمك!");
  }

  document.addEventListener("DOMContentLoaded", () => {
      const guestLoginButton = document.getElementById("guestLoginBtn");
      const registerButton = document.getElementById("registerBtn");
      const memberLoginButton = document.getElementById("memberLoginBtn");
      const termsButton = document.getElementById("termsBtn");
      const modalTermsLink = document.getElementById('modalTermsLink');
      const forgotPasswordLink = document.getElementById('forgotPasswordLink');

      // تهيئة عناصر رسائل الخطأ عند تحميل DOM
      errorMessageContainer = document.getElementById('errorMessageContainer');
      errorMessageText = document.getElementById('errorMessageText');


      if (guestLoginButton) {
          // زر "دخول الزوار" يفتح المودال الجديد لدخول الزوار
          guestLoginButton.addEventListener("click", showGuestLoginModal);
      }
      if (registerButton) {
          registerButton.addEventListener("click", showRegisterModal);
      }
      if (memberLoginButton) {
          memberLoginButton.addEventListener("click", showLoginModal);
      }
      if (termsButton) {
          termsButton.addEventListener("click", showRules);
      }
      if (modalTermsLink) {
          modalTermsLink.addEventListener('click', showRules);
      }
      if (forgotPasswordLink) {
          forgotPasswordLink.addEventListener('click', () => {
              alert("تواصل مع الدعم الفني لاستعادة كلمة المرور.");
          });
      }
  });

</script>

</head>
<body>
<div id="errorMessageContainer" class="error-message-container">
    <p id="errorMessageText"></p>
</div>

<div id="login_wrap" class="back_login">
	<p></p>
	<p></p>
	<div id="intro_top" class="btable">
	<div class="bcell_mid">
	<div id="login_all" class="pad60">
	<div class="login_text bpad15 centered_element">
	<div class="welecome">
        😍 منوّر في شات صدى الكلام!
	</div>	 
	</div>
	<div class="centered_element login_box">
<div class="clear"></div>
<button id="guestLoginBtn" class="loginanag"><i class="fa fa-rocket"></i> دخــول الزوار</button>
<div id="not_yet_member" class="login_not_member bclick">
<button id="registerBtn" class="loginanar"><i class="fa fa-user"></i> ســـجـل الآن</button>
</div>
<button id="memberLoginBtn" class="loginana"><i class="fa fa-send"></i> دخول بالعضوية</button>
</div>
								
	<div class="wama">
<div class="warning-msg">
<p dir="rtl" align="" style="font-family: 'Cairo', sans-serif; font-weight: bold;">⚠️تنبيه: الحرص على إثراء الدردشة بمعلومات <span lang="ar-sa">قيّمة</span> 
ومفيدة، ونشر المحتوى <span lang="ar-sa">الجيّد</span> الذي يساعد المستخدمين 
للحصول على المزيد من المعلومات والأفكار الحديثة، حيث يتم تنفيذ<span lang="ar-sa"> 
مراقبة وإشراف </span>قوي وفعّال وحظر المستخدمين المسيئين الذين ينتهكون شروط استخدام التطبيق أو سياسة المستخدم 
UGC.	
</div>

<div class="test_call"><span class="" onclick="window.open('https://aliraq.chat/contact_us.php', '_blank');"><p dir="rtl" align="" style="font-family: 'Cairo', sans-serif; font-weight: bold;"><i class="fa fa-envelope"></i> اتصل بنا </p></span></div>
</div>

<script defer="false" src="js/function_login3d06.js?v=6.17"></script>
<div class="agree2022">
<p class=""> <span id="termsBtn" class="" style="font-family: 'Cairo', sans-serif; font-weight: bold;"><i class="fa fa-exclamation-triangle">&nbsp;</i>بتسجيلك أنت توافق على شروط الاستخدام(UGC)</span></p>	</div>
</div><script data-cfasync="false">
	var recapt = 0;
	var recaptKey = '';
</script>

<div id="registerModalOverlay" class="modal-overlay">
    <div class="modal-content-custom">
        <button id="modalCloseBtn" class="modal-close-btn">&times;</button>
        <h2 class="modal-title">إنشاء حساب (عضوية كاملة)</h2>
        <form id="registerModalForm">
            <div class="modal-input-group">
                <input type="text" id="usernameInput" class="modal-input" placeholder="البريد الإلكتروني (مثال: user@example.com)">
            </div>
            <div class="modal-input-group">
                <input type="password" id="passwordInput" class="modal-input" placeholder="كلمة المرور (على الأقل 6 أحرف)">
            </div>
            <div class="modal-select-group">
                <div class="modal-select-wrapper">
                    <select id="ageSelect" class="modal-select">
                        <option value="">العمر</option>
                        <script>
                            for (let i = 13; i <= 99; i++) {
                                document.write(`<option value="${i}">${i}</option>`);
                            }
                        </script>
                    </select>
                </div>
                <div class="modal-select-wrapper">
                    <select id="genderSelect" class="modal-select">
                        <option value="">الجنس</option>
                        <option value="male">ذكر</option>
                        <option value="female">أنثى</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="modal-submit-button">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4z"/></svg>
                إنشاء حساب
            </button>
        </form>
        <p class="modal-terms">بتسجيلك أنت توافق على <span id="modalTermsLink">شروط الاستخدام</span></p>
    </div>
</div>

<div id="loginModalOverlay" class="modal-overlay">
    <div class="modal-content-custom">
        <button id="loginModalCloseBtn" class="modal-close-btn">&times;</button>
        <h2 class="modal-title">دخول الأعضاء</h2>
        <form id="loginModalForm">
            <div class="modal-input-group">
                <input type="text" id="loginIdentifierInput" name="identifier" class="modal-input" 
                       placeholder="البريد الإلكتروني أو اسم المستخدم">
            </div>
            <div class="modal-input-group">
                <input type="password" id="loginPasswordInput" name="password" class="modal-input" placeholder="كلمة المرور">
            </div>
            <button type="submit" class="modal-submit-button">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4z"/></svg>
                دخول
            </button>
        </form>
        <p class="modal-terms"><span id="forgotPasswordLink">نسيت كلمة المرور؟</span></p>
    </div>
</div>

<div id="guestLoginModalOverlay" class="modal-overlay">
    <div class="modal-content-custom">
        <button id="guestLoginModalCloseBtn" class="modal-close-btn">&times;</button>
        <h2 class="modal-title">دخول كزائر</h2>
        <form id="guestLoginForm">
            <div class="modal-input-group">
                <input type="text" id="guestUsernameInput" class="modal-input" placeholder="اسم المستخدم للزائر">
            </div>
            <div class="modal-select-group">
                <div class="modal-select-wrapper">
                    <select id="guestAgeSelect" class="modal-select">
                        <option value="">العمر</option>
                        <script>
                            for (let i = 13; i <= 99; i++) {
                                document.write(`<option value="${i}">${i}</option>`);
                            }
                        </script>
                    </select>
                </div>
                <div class="modal-select-wrapper">
                    <select id="guestGenderSelect" class="modal-select">
                        <option value="">الجنس</option>
                        <option value="male">ذكر</option>
                        <option value="female">أنثى</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="modal-submit-button">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4z"/></svg>
                دخول كزائر
            </button>
        </form>
    </div>
</div>


<div id="small_modal" class="small_modal_out modal_back">
	<div id="small_modal_in" class="small_modal_in modal_in back_modal modal_pad">
		<div class="modal_close cancel_modal">
			<div class="bcell_mid">
				<i class="fa fa-times"></i>
			</div>
		</div>
		<div id="small_modal_content" class="modal_content small_modal_content">
		</div>
	</div>
</div>
<div id="large_modal" class="large_modal_out modal_back">
	<div id="large_modal_in" class="large_modal_in modal_in back_modal">
		<div id="large_modal_content" class="modal_content large_modal_content">
		</div>
	</div>
</div>
<div id="over_modal" class="over_modal_out modal_back">
	<div id="over_modal_in" class="over_modal_in modal_in back_modal modal_pad">
		<div class="modal_close cancel_over">
			<div class="bcell_mid">
				<i class="fa fa-times"></i>
			</div>
		</div>
		<div id="over_modal_content" class="modal_content over_modal_content">
		</div>
	</div>
</div>
<div id="over_emodal" class="over_emodal_out modal_back">
	<div id="over_emodal_in" class="over_emodal_in modal_in back_modal">
		<div id="over_emodal_content" class="modal_content over_emodal_content">
		</div>
	</div>
</div>
<div id='container_stream' class="streamers vidstream background_stream">
	<div class="btable stream_header">
		<div id="move_video" class="bcell_mid">
		</div>
		<div onclick="toggleStream(1);" class="bcell_mid vidminus vidopt">
			<i class="fa fa-minus"></i>
		</div>
		<div onclick="closeVideo();" class="bcell_mid vidopt">
			<i class="fa fa-times"></i>
		</div>
	</div>
	<div id='wrap_stream'>
	</div>
</div>
<div id='container_stream_audio' class="streamers audstream background_stream">
	<div class="btable stream_header">
		<div id="move_audio" class="bcell_mid">
		</div>
		<div onclick="toggleStreamAudio(1);" class="bcell_mid vidminus vidopt">
			<i class="fa fa-minus"></i>
		</div>
		<div onclick="closeAudio();" class="bcell_mid vidopt">
			<i class="fa fa-times"></i>
		</div>
	</div>
	<div id='wrap_stream_audio'>
	</div>
</div>
<div id="container_call" class="callsize streamers vcallstream background_stream call_back">
	<div class="btable stream_header">
		<div id="move_cam" class="bcell_mid">
		</div>
		<div onclick="toggleCall(1);" class="bcell_mid vidopt">
			<i class="fa fa-minus"></i>
		</div>
		<div class="hide_call bcell_mid vidopt">
			<i class="fa fa-times"></i>
		</div>
	</div>
	<div id="wrap_call" class="callsize">
	</div>
</div>
<div class="saved_data">
	<span class="saved_span"></span>
</div>
<div class="theme_color hidden">
</div>
<link href="https://fonts.googleapis.com/css2?family=Signika:wght@400;700&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Grandstander:wght@400;700;900&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Lemonada:wght@400;700&amp;display=swap" rel="stylesheet"> 
</body>
</html>
